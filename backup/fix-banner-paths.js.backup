// ê¸°ì¡´ ë°°ë„ˆ ê²½ë¡œ ìˆ˜ì • ìŠ¤í¬ë¦½íŠ¸
// MongoDBì—ì„œ ì‹¤í–‰í•˜ê±°ë‚˜ ë³„ë„ ìŠ¤í¬ë¦½íŠ¸ë¡œ ì‹¤í–‰

import mongoose from 'mongoose';
import { Banner } from './src/models/Banner.js';
import dotenv from 'dotenv';

dotenv.config();

// MongoDB ì—°ê²°
await mongoose.connect(process.env.MONGODB_URI);

try {
    // ëª¨ë“  ë°°ë„ˆ ì¡°íšŒ
    const banners = await Banner.find({});
    
    console.log(`ì´ ${banners.length}ê°œì˜ ë°°ë„ˆë¥¼ ì°¾ì•˜ìŠµë‹ˆë‹¤.`);
    
    for (const banner of banners) {
        if (banner.image && banner.image.path) {
            const oldPath = banner.image.path;
            
            // Windows ê²½ë¡œê°€ í¬í•¨ë˜ì–´ ìˆë‹¤ë©´ ìˆ˜ì •
            if (oldPath.includes('\\') || oldPath.includes('C:') || oldPath.startsWith('uploads\\')) {
                const filename = banner.image.filename;
                const newPath = `uploads/banners/${filename}`;
                
                await Banner.findByIdAndUpdate(banner._id, {
                    'image.path': newPath
                });
                
                console.log(`âœ… ë°°ë„ˆ ${banner.title} ê²½ë¡œ ìˆ˜ì •:`);
                console.log(`   ì´ì „: ${oldPath}`);
                console.log(`   ì´í›„: ${newPath}`);
            } else {
                console.log(`âœ… ë°°ë„ˆ ${banner.title} ê²½ë¡œëŠ” ì˜¬ë°”ë¦„: ${oldPath}`);
            }
        }
    }
    
    console.log('ğŸ‰ ë°°ë„ˆ ê²½ë¡œ ìˆ˜ì • ì™„ë£Œ!');
} catch (error) {
    console.error('âŒ ì—ëŸ¬ ë°œìƒ:', error);
} finally {
    await mongoose.disconnect();
}
